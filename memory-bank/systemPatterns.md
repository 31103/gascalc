# System Patterns

## アーキテクチャ

- **シングルページアプリケーション (SPA):** `gascalc.html` という単一の HTML
  ファイルで構成されています。
- **クライアントサイドレンダリング:** すべてのロジックと UI 更新はブラウザ側の
  JavaScript で実行されます。サーバーサイドの処理はありません。
- **バニラ JavaScript:** フレームワークやライブラリを使用せず、標準の Web API
  (HTML, CSS, JavaScript) のみで実装されています。

## データ管理

- **インメモリ:** 入力されたデータ（日付時刻、流量、FiO2）は JavaScript の
  `entries` 配列にオブジェクトとして格納されます。
- **非永続的:**
  データはブラウザのメモリ上にのみ存在し、ページのリロードやクローズで失われます。ローカルストレージ等による永続化は行われていません。
- **ソート:** 新しいデータが追加されるたびに `entries`
  配列は日付時刻順にソートされます。

## UI パターン

- **DOM 直接操作:** `updateUI()` 関数が `entries` 配列の内容に基づいて HTML
  要素（リスト項目など）を動的に生成・更新します。
- **イベント駆動:**
  ユーザーのアクション（ボタンクリック、入力、設定変更）は、HTML
  要素に直接記述された `onclick` ハンドラや `addEventListener`
  によって捕捉され、対応する JavaScript 関数が実行されます。
- **状態に応じた表示切替:** 設定（FiO2
  モード、室内気不使用モード）に応じて、関連する入力フィールドや計算結果の表示内容が動的に変更されます
  (`toggleFio2Mode`, `toggleNoRoomAirMode`, `updateUI` 内の条件分岐)。

## 計算ロジック

- **時間ベース計算:** `calculateUsage()` 関数は、ソートされた `entries`
  配列を基に、各入力間の時間差を計算し、その期間の流量と FiO2
  設定に基づいてガス使用量を積算します。
- **日ごと集計:**
  計算は日単位で行われ、日付が変わるタイミングで集計がリセットされます。
- **条件分岐:** FiO2
  モードおよび室内気不使用モードの状態に応じて、適用される計算式が
  `calculateUsage()` 内で切り替えられます。

## 状態管理

- **グローバル変数:** アプリケーションの状態（FiO2
  モードが有効か、室内気不使用モードが有効か、最後に入力された日付）は、グローバルな
  JavaScript 変数 (`fio2Mode`, `noRoomAirMode`, `lastDate`)
  によって管理されています。
